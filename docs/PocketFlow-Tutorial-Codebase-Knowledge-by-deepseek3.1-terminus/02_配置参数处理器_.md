# Chapter 2: é…ç½®å‚æ•°å¤„ç†å™¨

æ¬¢è¿æ¥åˆ° PocketFlow æ•™ç¨‹ä»£ç åº“çŸ¥è¯†ç³»åˆ—çš„ç¬¬äºŒç« ï¼åœ¨ä¸Šä¸€ç« ä¸­ï¼Œæˆ‘ä»¬å­¦ä¹ äº†æ•™ç¨‹ç”Ÿæˆæµç¨‹å¦‚ä½•åè°ƒå„ä¸ªå¤„ç†èŠ‚ç‚¹ï¼Œå°±åƒä¸€ä¸ªæ™ºèƒ½çš„æµæ°´çº¿æŒ‡æŒ¥å®˜ã€‚æœ¬ç« æˆ‘ä»¬å°†æ·±å…¥äº†è§£ç¬¬ä¸€ä¸ªé‡è¦çš„å¤„ç†èŠ‚ç‚¹â€”â€”**é…ç½®å‚æ•°å¤„ç†å™¨**ï¼Œå®ƒå°±åƒæ˜¯æ•´ä¸ªç³»ç»Ÿçš„"é…ç½®ç®¡ç†å‘˜"ã€‚

## ä¸ºä»€ä¹ˆéœ€è¦é…ç½®å‚æ•°å¤„ç†å™¨ï¼Ÿ

æƒ³è±¡ä¸€ä¸‹ä½ è¦ä½¿ç”¨ä¸€å°å¤æ‚çš„å’–å•¡æœºã€‚å¦‚æœæ¯æ¬¡éƒ½éœ€è¦æ‰‹åŠ¨è®¾ç½®æ°´æ¸©ã€å’–å•¡ç²‰é‡ã€ç‰›å¥¶æ¯”ä¾‹ç­‰æ‰€æœ‰å‚æ•°ï¼Œä¸ä»…éº»çƒ¦è¿˜å®¹æ˜“å‡ºé”™ã€‚é…ç½®å‚æ•°å¤„ç†å™¨å°±åƒæ˜¯å’–å•¡æœºçš„æ™ºèƒ½æ§åˆ¶é¢æ¿ï¼Œå®ƒå¸®ä½ ï¼š

- ğŸ“ **æ”¶é›†è®¾ç½®**ï¼šè‡ªåŠ¨è·å–ä½ çš„åå¥½é…ç½®
- âœ… **éªŒè¯å‚æ•°**ï¼šç¡®ä¿è®¾ç½®åˆç†æœ‰æ•ˆ  
- ğŸ”§ **è®¾ç½®é»˜è®¤å€¼**ï¼šä¸ºç¼ºå¤±å‚æ•°æä¾›æ™ºèƒ½é»˜è®¤å€¼
- ğŸ¯ **ç»Ÿä¸€ç®¡ç†**ï¼šä¸ºæ•´ä¸ªç³»ç»Ÿæä¾›ä¸€è‡´çš„é…ç½®æ¥å£

## é…ç½®å‚æ•°å¤„ç†å™¨çš„å·¥ä½œåŸç†

è®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥ç†è§£å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚å½“ä½ è¿è¡Œæ•™ç¨‹ç”Ÿæˆå‘½ä»¤æ—¶ï¼Œ`main.py` æ–‡ä»¶ä¸­çš„å‚æ•°è§£æéƒ¨åˆ†å°±æ˜¯é…ç½®å‚æ•°å¤„ç†å™¨çš„æ ¸å¿ƒï¼š

```python
def main():
    parser = argparse.ArgumentParser(description="ä¸ºGitHubä»£ç åº“æˆ–æœ¬åœ°ç›®å½•ç”Ÿæˆæ•™ç¨‹")
    
    # åˆ›å»ºäº’æ–¥çš„æºé€‰æ‹©ç»„
    source_group = parser.add_mutually_exclusive_group(required=True)
    source_group.add_argument("--repo", help="GitHubä»“åº“çš„URL")
    source_group.add_argument("--dir", help="æœ¬åœ°ç›®å½•è·¯å¾„")
    
    parser.add_argument("-n", "--name", help="é¡¹ç›®åç§°ï¼ˆå¯é€‰ï¼Œå¦‚æœªæä¾›åˆ™ä»ä»“åº“/ç›®å½•æ´¾ç”Ÿï¼‰")
    parser.add_argument("-t", "--token", help="GitHubä¸ªäººè®¿é—®ä»¤ç‰Œ")
    # ... æ›´å¤šå‚æ•°è®¾ç½®
```

è¿™æ®µä»£ç å®šä¹‰äº†æˆ‘ä»¬èƒ½å¤Ÿæ¥æ”¶çš„æ‰€æœ‰é…ç½®é€‰é¡¹ã€‚å½“ç”¨æˆ·è¿è¡Œå‘½ä»¤æ—¶ï¼Œé…ç½®å‚æ•°å¤„ç†å™¨å°±å¼€å§‹å·¥ä½œäº†ã€‚

## æ ¸å¿ƒåŠŸèƒ½è¯¦è§£

### 1. å‚æ•°æ”¶é›†ä¸éªŒè¯

é…ç½®å‚æ•°å¤„ç†å™¨é¦–å…ˆæ”¶é›†ç”¨æˆ·è¾“å…¥çš„æ‰€æœ‰å‚æ•°ï¼Œå¹¶è¿›è¡ŒåŸºæœ¬éªŒè¯ï¼š

```python
# è§£æå‘½ä»¤è¡Œå‚æ•°
args = parser.parse_args()

# éªŒè¯GitHubä»¤ç‰Œï¼ˆå¦‚æœä½¿ç”¨ä»“åº“ï¼‰
github_token = None
if args.repo:
    github_token = args.token or os.environ.get('GITHUB_TOKEN')
    if not github_token:
        print("è­¦å‘Šï¼šæœªæä¾›GitHubä»¤ç‰Œï¼Œè®¿é—®å…¬å¼€ä»“åº“å¯èƒ½ä¼šå—åˆ°é™åˆ¶")
```

è¿™ç¡®ä¿äº†å¿…è¦çš„å‚æ•°éƒ½å­˜åœ¨ä¸”æœ‰æ•ˆï¼Œå°±åƒå’–å•¡æœºæ£€æŸ¥æ˜¯å¦æœ‰è¶³å¤Ÿçš„æ°´å’Œå’–å•¡è±†ä¸€æ ·ã€‚

### 2. è®¾ç½®é»˜è®¤å€¼

å¯¹äºç”¨æˆ·æ²¡æœ‰æ˜ç¡®è®¾ç½®çš„å‚æ•°ï¼Œé…ç½®å‚æ•°å¤„ç†å™¨ä¼šæä¾›æ™ºèƒ½é»˜è®¤å€¼ï¼š

```python
# é»˜è®¤æ–‡ä»¶åŒ…å«æ¨¡å¼
DEFAULT_INCLUDE_PATTERNS = {
    "*.py", "*.js", "*.jsx", "*.ts", "*.tsx", "*.go", "*.java",
    "*.md", "*.rst", "*Dockerfile", "*Makefile", "*.yaml", "*.yml"
}

# é»˜è®¤æ’é™¤æ¨¡å¼ï¼ˆè·³è¿‡æµ‹è¯•æ–‡ä»¶ã€æ„å»ºç›®å½•ç­‰ï¼‰
DEFAULT_EXCLUDE_PATTERNS = {
    "*test*", "*tests/*", "*examples/*", "*dist/*", "*build/*",
    "*node_modules/*", ".git/*", ".github/*"
}

# åœ¨å…±äº«å­—å…¸ä¸­è®¾ç½®é…ç½®
shared = {
    "include_patterns": set(args.include) if args.include else DEFAULT_INCLUDE_PATTERNS,
    "exclude_patterns": set(args.exclude) if args.exclude else DEFAULT_EXCLUDE_PATTERNS,
    "max_file_size": args.max_size if args.max_size else 100000,
    "language": args.language if args.language else "english",
    "use_cache": not args.no_cache,  # é»˜è®¤å¯ç”¨ç¼“å­˜
    "max_abstraction_num": args.max_abstractions if args.max_abstractions else 10
}
```

### 3. å¤šè¯­è¨€æ”¯æŒ

é…ç½®å‚æ•°å¤„ç†å™¨è¿˜è´Ÿè´£å¤„ç†è¯­è¨€è®¾ç½®ï¼Œç¡®ä¿ç”Ÿæˆçš„æ•™ç¨‹ç¬¦åˆç”¨æˆ·çš„è¯­è¨€åå¥½ï¼š

```python
# è®¾ç½®ç”Ÿæˆè¯­è¨€
shared["language"] = args.language

# æ˜¾ç¤ºå¯åŠ¨ä¿¡æ¯
print(f"å¼€å§‹ä¸ºä»¥ä¸‹ç›®æ ‡ç”Ÿæˆæ•™ç¨‹ï¼š{args.repo or args.dir}ï¼Œè¯­è¨€ï¼š{args.language}")
print(f"LLMç¼“å­˜ï¼š{'å·²ç¦ç”¨' if args.no_cache else 'å·²å¯ç”¨'}")
```

## å®é™…å·¥ä½œæµç¨‹

è®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªåºåˆ—å›¾æ¥çœ‹çœ‹é…ç½®å‚æ•°å¤„ç†å™¨åœ¨å®Œæ•´æµç¨‹ä¸­çš„è§’è‰²ï¼š

```mermaid
sequenceDiagram
    participant ç”¨æˆ·
    participant ä¸»ç¨‹åº
    participant é…ç½®å‚æ•°å¤„ç†å™¨
    participant åç»­èŠ‚ç‚¹
    
    ç”¨æˆ·->>ä¸»ç¨‹åº: python main.py --repo URL --language chinese
    ä¸»ç¨‹åº->>é…ç½®å‚æ•°å¤„ç†å™¨: è§£æå‘½ä»¤è¡Œå‚æ•°
    é…ç½®å‚æ•°å¤„ç†å™¨->>é…ç½®å‚æ•°å¤„ç†å™¨: éªŒè¯å‚æ•°æœ‰æ•ˆæ€§
    é…ç½®å‚æ•°å¤„ç†å™¨->>é…ç½®å‚æ•°å¤„ç†å™¨: è®¾ç½®é»˜è®¤å€¼
    é…ç½®å‚æ•°å¤„ç†å™¨->>é…ç½®å‚æ•°å¤„ç†å™¨: å‡†å¤‡å…±äº«é…ç½®å­—å…¸
    é…ç½®å‚æ•°å¤„ç†å™¨-->>ä¸»ç¨‹åº: è¿”å›å®Œæ•´é…ç½®
    ä¸»ç¨‹åº->>åç»­èŠ‚ç‚¹: ä¼ é€’é…ç½®ï¼Œå¯åŠ¨æ•™ç¨‹ç”Ÿæˆæµç¨‹
    åç»­èŠ‚ç‚¹-->>ç”¨æˆ·: ç”Ÿæˆä¸­æ–‡æ•™ç¨‹æ–‡æ¡£
```

## é…ç½®å‚æ•°å¤„ç†å™¨çš„å†…éƒ¨å®ç°

è™½ç„¶é…ç½®å‚æ•°å¤„ç†å™¨ä¸»è¦ä½äº `main.py` ä¸­ï¼Œä½†å®ƒçš„è®¾è®¡æ€æƒ³è´¯ç©¿æ•´ä¸ªç³»ç»Ÿã€‚æ¯ä¸ªå¤„ç†èŠ‚ç‚¹åœ¨å‡†å¤‡é˜¶æ®µéƒ½ä¼šä»å…±äº«å­—å…¸ä¸­è·å–é…ç½®ï¼š

```python
class FetchRepo(Node):
    def prep(self, shared):
        # ä»å…±äº«é…ç½®ä¸­è·å–å‚æ•°
        repo_url = shared.get("repo_url")
        local_dir = shared.get("local_dir")
        include_patterns = shared["include_patterns"]  # ä½¿ç”¨é…ç½®çš„å‚æ•°
        exclude_patterns = shared["exclude_patterns"]
        max_file_size = shared["max_file_size"]
        
        return {
            "repo_url": repo_url,
            "local_dir": local_dir,
            "include_patterns": include_patterns,
            "exclude_patterns": exclude_patterns,
            "max_file_size": max_file_size
        }
```

è¿™ç§è®¾è®¡ç¡®ä¿äº†é…ç½®çš„ä¸€è‡´æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚å°±åƒå»ºç­‘å·¥åœ°çš„é¡¹ç›®ç»ç†ï¼Œé…ç½®å‚æ•°å¤„ç†å™¨ç¡®ä¿æ¯ä¸ªå·¥äººéƒ½ä½¿ç”¨æ­£ç¡®çš„å·¥å…·å’Œææ–™ã€‚

## å®é™…ä½¿ç”¨ç¤ºä¾‹

å‡è®¾æˆ‘ä»¬è¦ä¸ºä¸€ä¸ªPythoné¡¹ç›®ç”Ÿæˆä¸­æ–‡æ•™ç¨‹ï¼Œå¯ä»¥è¿™æ ·ä½¿ç”¨ï¼š

```bash
python main.py --repo https://github.com/example/project.git \
              --language chinese \
              --name "æˆ‘çš„é¡¹ç›®" \
              --include "*.py" "*.md" \
              --exclude "tests/*" "docs/*"
```

é…ç½®å‚æ•°å¤„ç†å™¨ä¼šå°†è¿™äº›å‚æ•°è½¬æ¢ä¸ºç³»ç»Ÿå†…éƒ¨çš„æ ‡å‡†æ ¼å¼ï¼Œç¡®ä¿åç»­æ‰€æœ‰å¤„ç†èŠ‚ç‚¹éƒ½èƒ½æ­£ç¡®ç†è§£å’Œä½¿ç”¨è¿™äº›é…ç½®ã€‚

## æ€»ç»“

é€šè¿‡æœ¬ç« çš„å­¦ä¹ ï¼Œæˆ‘ä»¬äº†è§£äº†é…ç½®å‚æ•°å¤„ç†å™¨çš„æ ¸å¿ƒä½œç”¨ï¼š

- ğŸ›ï¸ **é…ç½®æ”¶é›†å™¨**ï¼šç»Ÿä¸€ç®¡ç†æ‰€æœ‰ç”¨æˆ·è¾“å…¥å’Œç³»ç»Ÿé…ç½®
- ğŸ›¡ï¸ **å‚æ•°éªŒè¯å™¨**ï¼šç¡®ä¿é…ç½®çš„åˆç†æ€§å’Œæœ‰æ•ˆæ€§  
- ğŸ”§ **é»˜è®¤å€¼æä¾›è€…**ï¼šä¸ºç¼ºå¤±å‚æ•°æä¾›æ™ºèƒ½é»˜è®¤å€¼
- ğŸŒ **å¤šè¯­è¨€æ”¯æŒè€…**ï¼šå¤„ç†è¯­è¨€åå¥½è®¾ç½®
- ğŸ”„ **é…ç½®åˆ†å‘è€…**ï¼šä¸ºæ•´ä¸ªç³»ç»Ÿæä¾›ä¸€è‡´çš„é…ç½®æ¥å£

é…ç½®å‚æ•°å¤„ç†å™¨å°±åƒæ˜¯æ•™ç¨‹ç”Ÿæˆç³»ç»Ÿçš„"å®ˆé—¨äºº"ï¼Œå®ƒç¡®ä¿æ‰€æœ‰åç»­å¤„ç†éƒ½åœ¨æ­£ç¡®çš„é…ç½®ç¯å¢ƒä¸‹è¿›è¡Œï¼Œä¸ºç”Ÿæˆé«˜è´¨é‡çš„æ•™ç¨‹æ–‡æ¡£å¥ å®šäº†åšå®åŸºç¡€ã€‚

åœ¨ä¸‹ä¸€ç« ä¸­ï¼Œæˆ‘ä»¬å°†æ¢ç´¢[ä»£ç åº“è·å–å™¨](03_ä»£ç åº“è·å–å™¨_.md)ï¼Œå­¦ä¹ ç³»ç»Ÿå¦‚ä½•ä»GitHubä»“åº“æˆ–æœ¬åœ°ç›®å½•è·å–æºä»£ç æ–‡ä»¶ã€‚è®©æˆ‘ä»¬ç»§ç»­è¿™ä¸ªç²¾å½©çš„å­¦ä¹ ä¹‹æ—…ï¼

---

Generated by [AI Codebase Knowledge Builder](https://github.com/The-Pocket/Tutorial-Codebase-Knowledge)