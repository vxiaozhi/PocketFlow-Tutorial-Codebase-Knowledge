# 源码分析

处理流水线由六个顺序执行的处理节点组成

## 1. FetchRepo - 数据收集器

FetchRepo 节点是流水线的入口点。其主要职责是从 GitHub 仓库或本地目录收集代码文件。

主要功能：

- 支持 GitHub 仓库和本地目录
- 应用包含/排除模式的智能文件过滤
- 处理文件大小限制，避免处理过大的文件
- 使用相对路径以提高可移植性
- 该节点输出包含文件路径及其内容的元组列表，成为所有后续分析的基础。


## 2. IdentifyAbstractions - 概念提取器

代码收集完成后，IdentifyAbstractions 节点使用 AI 来识别代码库中的核心抽象。这是框架智能的真正体现！

该节点：

- 分析整个代码库上下文
- 识别最重要的 5-10 个抽象
- 提供带有类比的新手友好描述
- 将相关文件映射到每个抽象
- 支持抽象名称和描述的多语言输出
- 抽象识别过程使用精密的提示词，引导 AI 专注于那些对新手理解代码库结构最有帮助的概念。

### Prompt

```
For the project `{project_name}`:

Codebase Context:
{context}

IMPORTANT: Generate the `name` and `description` for each abstraction in **{language.capitalize()}** language. Do NOT use English for these fields.


Analyze the codebase context.
Identify the top 5-{max_abstraction_num} core most important abstractions to help those new to the codebase.

For each abstraction, provide:
1. A concise `name`{name_lang_hint}.
2. A beginner-friendly `description` explaining what it is with a simple analogy, in around 100 words{desc_lang_hint}.
3. A list of relevant `file_indices` (integers) using the format `idx # path/comment`.

List of file indices and paths present in the context:
{file_listing_for_prompt}

Format the output as a YAML list of dictionaries:

"""yaml
- name: |
    Query Processing{name_lang_hint}
  description: |
    Explains what the abstraction does.
    It's like a central dispatcher routing requests.{desc_lang_hint}
  file_indices:
    - 0 # path/to/file1.py
    - 3 # path/to/related.py
- name: |
    Query Optimization{name_lang_hint}
  description: |
    Another core concept, similar to a blueprint for objects.{desc_lang_hint}
  file_indices:
    - 5 # path/to/another.js
# ... up to {max_abstraction_num} abstractions
"""
```

```
对于项目 `{project_name}`：

代码库上下文：
{context}

重要提示：请用**中文**为每个抽象生成 `name` 和 `description` 字段，这些字段不得使用英文。

分析代码库上下文。
识别出5-{max_abstraction_num}个最核心、最重要的抽象概念，以帮助新成员快速理解代码库。

对每个抽象概念，请提供：
1. 简洁的 `name`（使用中文命名）
2. 适合初学者的 `description`（约100字），通过简单类比解释其功能
3. 相关的 `file_indices`（整数）列表，格式为 `idx # 路径/注释`

上下文中包含的文件索引及路径列表：
{file_listing_for_prompt}

输出格式要求：YAML字典列表:

"""yaml
- name: |
    Query Processing{name_lang_hint}
  description: |
    Explains what the abstraction does.
    It's like a central dispatcher routing requests.{desc_lang_hint}
  file_indices:
    - 0 # path/to/file1.py
    - 3 # path/to/related.py
- name: |
    Query Optimization{name_lang_hint}
  description: |
    Another core concept, similar to a blueprint for objects.{desc_lang_hint}
  file_indices:
    - 5 # path/to/another.js
# ... up to {max_abstraction_num} abstractions
"""
```

## 3. AnalyzeRelationships - 连接映射器
理解代码库不同部分如何交互对于学习至关重要。AnalyzeRelationships 节点映射已识别抽象之间的连接。

该节点：

分析抽象之间的交互方式
生成高级项目摘要
创建显示依赖关系和交互的关系图
确保每个抽象至少与另一个抽象相连
支持摘要和关系标签的多语言输出
输出包括文本摘要和结构化关系图，帮助用户快速理解代码库架构。

## 4. OrderChapters - 学习路径设计器
优秀的教程遵循逻辑渐进。OrderChapters 节点确定解释抽象的最佳学习顺序。

主要职责：

分析抽象之间的关系
确定最合乎逻辑的解释顺序
从基础概念开始，再转向高级主题
将面向用户的概念作为入口点
创建结构化的章节大纲
这确保生成的教程遵循自然的学习曲线，使复杂的代码库对初学者也能易于理解。


## 5. WriteChapters - 内容生成器

WriteChapters 节点是实际创建教程内容的地方。这是一个BatchNode，独立处理每个抽象以生成全面的章节内容。

显著特点：

- 为每个章节生成新手友好的 Markdown 内容
- 包含带有输入输出的代码示例
- 使用 Mermaid 图表进行可视化说明
- 提供内部实现演练
- 创建章节之间的过渡
- 支持完整的多语言内容生成
- 保持与之前编写章节的上下文连贯性
- 每个章节都经过精心设计，既独立完整，又与其他章节的相关概念保持联系。


## 6. CombineTutorial - 最终组装器

流水线的最后一步是 CombineTutorial，它将所有组件组装成完整的、可导航的教程结构。

该节点：

- 创建带有项目概览的 index.md 文件
- 生成显示抽象关系的 Mermaid 流程图
- 用适当的导航链接组织章节
- 添加归属信息和元数据
- 输出完整的教程目录结构
- 结果是一个专业外观的教程，用户可以像读书一样浏览，具有清晰的章节和可视化关系图。
